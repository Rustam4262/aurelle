# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å Redirect URIs –≤–æ –≤—Å–µ—Ö OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö.

## –í–∞–∂–Ω–æ!

–ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –≤–æ –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö –Ω–∏–∂–µ.

---

## 1. Google OAuth

### –í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ credentials:
- **Client ID**: `60089668488-9gvr0ahqda3neh2p3dsdvbofd39piguj.apps.googleusercontent.com`
- **Client Secret**: `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`

### –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –í –º–µ–Ω—é —Å–ª–µ–≤–∞: **APIs & Services** ‚Üí **Credentials**
4. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à OAuth 2.0 Client ID
5. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
6. –í —Ä–∞–∑–¥–µ–ª–µ **Authorized redirect URIs** –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   https://your-domain.com/api/auth/google/callback
   ```
7. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ www –ø–æ–¥–¥–æ–º–µ–Ω, –¥–æ–±–∞–≤—å—Ç–µ —Ç–∞–∫–∂–µ:
   ```
   https://www.your-domain.com/api/auth/google/callback
   ```
8. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ** –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
curl https://your-domain.com/api/auth/providers
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: { "google": true, ... }
```

---

## 2. Yandex OAuth

### –í–∞—à–∏ —Ç–µ–∫—É—â–∏–µ credentials:
- **Client ID**: `3b79a753092d49bb977ce1ec5b3017ec`
- **Client Secret**: `3086c3c9bf844b5298f801005307e4d4`

### –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [–Ø–Ω–¥–µ–∫—Å OAuth](https://oauth.yandex.ru/)
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ
4. –ù–∞–∂–º–∏—Ç–µ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å**
5. –í —Ä–∞–∑–¥–µ–ª–µ **Callback URI** (Redirect URI) –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   https://your-domain.com/api/auth/yandex/callback
   ```
6. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ www –ø–æ–¥–¥–æ–º–µ–Ω, –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   https://www.your-domain.com/api/auth/yandex/callback
   ```
7. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ** –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
curl https://your-domain.com/api/auth/providers
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: { "yandex": true, ... }
```

---

## 3. GitHub OAuth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitHub OAuth:

### –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [GitHub Developer Settings](https://github.com/settings/developers)
2. –ù–∞–∂–º–∏—Ç–µ **New OAuth App** –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - **Application name**: `AURELLE`
   - **Homepage URL**: `https://your-domain.com`
   - **Application description**: `Beauty salon marketplace`
   - **Authorization callback URL**: `https://your-domain.com/api/auth/github/callback`
4. –ù–∞–∂–º–∏—Ç–µ **Register application** (–∏–ª–∏ **Update application**)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Client ID** –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ **Client Secret**
6. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ `.env` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```env
   GITHUB_CLIENT_ID=–≤–∞—à-client-id
   GITHUB_CLIENT_SECRET=–≤–∞—à-client-secret
   ```
7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   pm2 restart aurelle
   ```

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö —Å—Ç–∞—Ç—É—Å:

```bash
curl https://your-domain.com/api/auth/providers
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "local": true,
  "yandex": true,
  "google": true,
  "github": false,  // –∏–ª–∏ true, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏
  "phone": false    // –∏–ª–∏ true, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ Twilio
}
```

---

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth

### –¢–µ—Å—Ç Google OAuth:
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://your-domain.com/auth
2. –ù–∞–∂–º–∏—Ç–µ **Sign in with Google**
3. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Google
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤–µ—Ä–Ω–µ—Ç –Ω–∞ –≤–∞—à —Å–∞–π—Ç

### –¢–µ—Å—Ç Yandex OAuth:
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://your-domain.com/auth
2. –ù–∞–∂–º–∏—Ç–µ **–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å**
3. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤–µ—Ä–Ω–µ—Ç –Ω–∞ –≤–∞—à —Å–∞–π—Ç

---

## Troubleshooting

### –û—à–∏–±–∫–∞ "redirect_uri_mismatch"

**–ü—Ä–æ–±–ª–µ–º–∞**: Google/Yandex –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –æ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ redirect_uri

**–†–µ—à–µ–Ω–∏–µ**:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ **HTTPS** (–Ω–µ HTTP)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–æ–º–µ–Ω —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (–≤–∫–ª—é—á–∞—è www –∏–ª–∏ –±–µ–∑ –Ω–µ–≥–æ)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—É—Ç—å —Ç–æ—á–Ω–æ `/api/auth/google/callback` –∏–ª–∏ `/api/auth/yandex/callback`
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ redirect URI –±–µ–∑ trailing slash `/`

### OAuth —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ, –Ω–æ –Ω–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**:
1. `.env` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Client ID –∏ Secret
2. HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
3. Nginx –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ Node.js (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx)
4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ: `pm2 status aurelle`

**–õ–æ–≥–∏**:
```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 logs aurelle

# –õ–æ–≥–∏ Nginx
sudo tail -f /var/log/nginx/aurelle_error.log
```

### –°–µ—Å—Å–∏—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ OAuth

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `SESSION_SECRET` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω –¥–æ–º–µ–Ω (–Ω–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —Å/–±–µ–∑ www)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookies –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ credentials

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å Client ID –∏–ª–∏ Secret:

1. –û–±–Ω–æ–≤–∏—Ç–µ credentials –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Google/Yandex/GitHub)
2. –û–±–Ω–æ–≤–∏—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   nano /var/www/aurelle/.env
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   ```bash
   pm2 restart aurelle
   ```
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å:
   ```bash
   pm2 status aurelle
   pm2 logs aurelle --lines 50
   ```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ git**
   ```bash
   # –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env –≤ .gitignore
   echo ".env" >> .gitignore
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ credentials –¥–ª—è dev –∏ prod**
   - Development: `http://localhost:5000/api/auth/.../callback`
   - Production: `https://your-domain.com/api/auth/.../callback`

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ Client Secrets**
   - –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –∫–∞–∂–¥—ã–µ 6-12 –º–µ—Å—è—Ü–µ–≤
   - –ü—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—é - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –ø—Ä–∞–≤–∞ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
   - –ó–∞–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ scope
   - Google: `profile`, `email`
   - Yandex: –¥–æ—Å—Ç—É–ø –∫ email, –∞–≤–∞—Ç–∞—Ä—É, –∏–º–µ–Ω–∏

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Redirect URIs –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ Google OAuth Console
- [ ] Redirect URIs –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ Yandex OAuth
- [ ] `.env` —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç production credentials
- [ ] `SESSION_SECRET` —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π (–º–∏–Ω–∏–º—É–º 64 —Å–∏–º–≤–æ–ª–∞)
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ PM2
- [ ] Nginx –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Yandex
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

---

**–ì–æ—Ç–æ–≤–æ! OAuth –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.** üöÄ
